

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing &mdash; Symfony Docs 2.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Symfony Docs 2.3 documentation" href="../index.html" />
    <link rel="up" title="The Book" href="index.html" />
    <link rel="next" title="Validation" href="validation.html" />
    <link rel="prev" title="Databases and Propel" href="propel.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="validation.html" title="Validation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="propel.html" title="Databases and Propel"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Symfony Docs 2.3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">The Book</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="testing">
<span id="index-0"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Whenever you write a new line of code, you also potentially add new bugs.
To build better and more reliable applications, you should test your code
using both functional and unit tests.</p>
<div class="section" id="the-phpunit-testing-framework">
<h2>The PHPUnit Testing Framework<a class="headerlink" href="#the-phpunit-testing-framework" title="Permalink to this headline">¶</a></h2>
<p>Symfony2 integrates with an independent library - called PHPUnit - to give
you a rich testing framework. This chapter won&#8217;t cover PHPUnit itself, but
it has its own excellent <a class="reference external" href="http://www.phpunit.de/manual/3.5/en/">documentation</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Symfony2 works with PHPUnit 3.5.11 or later, though version 3.6.4 is
needed to test the Symfony core code itself.</p>
</div>
<p>Each test - whether it&#8217;s a unit test or a functional test - is a PHP class
that should live in the <cite>Tests/</cite> subdirectory of your bundles. If you follow
this rule, then you can run all of your application&#8217;s tests with the following
command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># specify the configuration directory on the command line</span>
<span class="nv">$ </span>phpunit -c app/
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">-c</span></tt> option tells PHPUnit to look in the <tt class="docutils literal"><span class="pre">app/</span></tt> directory for a configuration
file. If you&#8217;re curious about the PHPUnit options, check out the <tt class="docutils literal"><span class="pre">app/phpunit.xml.dist</span></tt>
file.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Code coverage can be generated with the <tt class="docutils literal"><span class="pre">--coverage-html</span></tt> option.</p>
</div>
</div>
<div class="section" id="unit-tests">
<span id="index-1"></span><h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>A unit test is usually a test against a specific PHP class. If you want to
test the overall behavior of your application, see the section about <a class="reference internal" href="#functional-tests">Functional Tests</a>.</p>
<p>Writing Symfony2 unit tests is no different than writing standard PHPUnit
unit tests. Suppose, for example, that you have an <em>incredibly</em> simple class
called <tt class="docutils literal"><span class="pre">Calculator</span></tt> in the <tt class="docutils literal"><span class="pre">Utility/</span></tt> directory of your bundle:</p>
<div class="highlight-python"><pre>// src/Acme/DemoBundle/Utility/Calculator.php
namespace Acme\DemoBundle\Utility;

class Calculator
{
    public function add($a, $b)
    {
        return $a + $b;
    }
}</pre>
</div>
<p>To test this, create a <tt class="docutils literal"><span class="pre">CalculatorTest</span></tt> file in the <tt class="docutils literal"><span class="pre">Tests/Utility</span></tt> directory
of your bundle:</p>
<div class="highlight-python"><pre>// src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php
namespace Acme\DemoBundle\Tests\Utility;

use Acme\DemoBundle\Utility\Calculator;

class CalculatorTest extends \PHPUnit_Framework_TestCase
{
    public function testAdd()
    {
        $calc = new Calculator();
        $result = $calc-&gt;add(30, 12);

        // assert that your calculator added the numbers correctly!
        $this-&gt;assertEquals(42, $result);
    }
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By convention, the <tt class="docutils literal"><span class="pre">Tests/</span></tt> sub-directory should replicate the directory
of your bundle. So, if you&#8217;re testing a class in your bundle&#8217;s <tt class="docutils literal"><span class="pre">Utility/</span></tt>
directory, put the test in the <tt class="docutils literal"><span class="pre">Tests/Utility/</span></tt> directory.</p>
</div>
<p>Just like in your real application - autoloading is automatically enabled
via the <tt class="docutils literal"><span class="pre">bootstrap.php.cache</span></tt> file (as configured by default in the <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt>
file).</p>
<p>Running tests for a given file or directory is also very easy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># run all tests in the Utility directory</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/Tests/Utility/

<span class="c"># run tests for the Calculator class</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php

<span class="c"># run all tests for the entire Bundle</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/
</pre></div>
</div>
</div>
<div class="section" id="functional-tests">
<span id="index-2"></span><h2>Functional Tests<a class="headerlink" href="#functional-tests" title="Permalink to this headline">¶</a></h2>
<p>Functional tests check the integration of the different layers of an
application (from the routing to the views). They are no different from unit
tests as far as PHPUnit is concerned, but they have a very specific workflow:</p>
<ul class="simple">
<li>Make a request;</li>
<li>Test the response;</li>
<li>Click on a link or submit a form;</li>
<li>Test the response;</li>
<li>Rinse and repeat.</li>
</ul>
<div class="section" id="your-first-functional-test">
<h3>Your First Functional Test<a class="headerlink" href="#your-first-functional-test" title="Permalink to this headline">¶</a></h3>
<p>Functional tests are simple PHP files that typically live in the <tt class="docutils literal"><span class="pre">Tests/Controller</span></tt>
directory of your bundle. If you want to test the pages handled by your
<tt class="docutils literal"><span class="pre">DemoController</span></tt> class, start by creating a new <tt class="docutils literal"><span class="pre">DemoControllerTest.php</span></tt>
file that extends a special <tt class="docutils literal"><span class="pre">WebTestCase</span></tt> class.</p>
<p>For example, the Symfony2 Standard Edition provides a simple functional test
for its <tt class="docutils literal"><span class="pre">DemoController</span></tt> (<a class="reference external" href="https://github.com/symfony/symfony-standard/blob/master/src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php">DemoControllerTest</a>) that reads as follows:</p>
<div class="highlight-python"><pre>// src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php
namespace Acme\DemoBundle\Tests\Controller;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class DemoControllerTest extends WebTestCase
{
    public function testIndex()
    {
        $client = static::createClient();

        $crawler = $client-&gt;request('GET', '/demo/hello/Fabien');

        $this-&gt;assertGreaterThan(
            0,
            $crawler-&gt;filter('html:contains("Hello Fabien")')-&gt;count()
        );
    }
}</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>To run your functional tests, the <tt class="docutils literal"><span class="pre">WebTestCase</span></tt> class bootstraps the
kernel of your application. In most cases, this happens automatically.
However, if your kernel is in a non-standard directory, you&#8217;ll need
to modify your <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt> file to set the <tt class="docutils literal"><span class="pre">KERNEL_DIR</span></tt> environment
variable to the directory of your kernel:</p>
<div class="last highlight-xml"><div class="highlight"><pre><span class="nt">&lt;phpunit&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;php&gt;</span>
        <span class="nt">&lt;server</span> <span class="na">name=</span><span class="s">&quot;KERNEL_DIR&quot;</span> <span class="na">value=</span><span class="s">&quot;/path/to/your/app/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</div>
</div>
<p>The <tt class="docutils literal"><span class="pre">createClient()</span></tt> method returns a client, which is like a browser that
you&#8217;ll use to crawl your site:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;request('GET', '/demo/hello/Fabien');</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">request()</span></tt> method (see <a class="reference internal" href="#book-testing-request-method-sidebar"><em>more about the request method</em></a>)
returns a <tt class="docutils literal"><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/DomCrawler/Crawler.html" title="Symfony\Component\DomCrawler\Crawler"><span class="pre">Crawler</span></a></tt> object which can
be used to select elements in the Response, click on links, and submit forms.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The Crawler only works when the response is an XML or an HTML document.
To get the raw content response, call <tt class="docutils literal"><span class="pre">$client-&gt;getResponse()-&gt;getContent()</span></tt>.</p>
</div>
<p>Click on a link by first selecting it with the Crawler using either an XPath
expression or a CSS selector, then use the Client to click on it. For example,
the following code finds all links with the text <tt class="docutils literal"><span class="pre">Greet</span></tt>, then selects
the second one, and ultimately clicks on it:</p>
<div class="highlight-python"><pre>$link = $crawler-&gt;filter('a:contains("Greet")')-&gt;eq(1)-&gt;link();

$crawler = $client-&gt;click($link);</pre>
</div>
<p>Submitting a form is very similar; select a form button, optionally override
some form values, and submit the corresponding form:</p>
<div class="highlight-python"><pre>$form = $crawler-&gt;selectButton('submit')-&gt;form();

// set some values
$form['name'] = 'Lucas';
$form['form_name[subject]'] = 'Hey there!';

// submit the form
$crawler = $client-&gt;submit($form);</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The form can also handle uploads and contains methods to fill in different types
of form fields (e.g. <tt class="docutils literal"><span class="pre">select()</span></tt> and <tt class="docutils literal"><span class="pre">tick()</span></tt>). For details, see the
<a class="reference internal" href="#forms">Forms</a> section below.</p>
</div>
<p>Now that you can easily navigate through an application, use assertions to test
that it actually does what you expect it to. Use the Crawler to make assertions
on the DOM:</p>
<div class="highlight-python"><pre>// Assert that the response matches a given CSS selector.
$this-&gt;assertGreaterThan(0, $crawler-&gt;filter('h1')-&gt;count());</pre>
</div>
<p>Or, test against the Response content directly if you just want to assert that
the content contains some text, or if the Response is not an XML/HTML
document:</p>
<div class="highlight-python"><pre>$this-&gt;assertRegExp(
    '/Hello Fabien/',
    $client-&gt;getResponse()-&gt;getContent()
);</pre>
</div>
<div class="sidebar" id="book-testing-request-method-sidebar">
<p class="first sidebar-title">More about the <tt class="docutils literal"><span class="pre">request()</span></tt> method:</p>
<p>The full signature of the <tt class="docutils literal"><span class="pre">request()</span></tt> method is:</p>
<div class="highlight-python"><pre>request(
    $method,
    $uri,
    array $parameters = array(),
    array $files = array(),
    array $server = array(),
    $content = null,
    $changeHistory = true
)</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">server</span></tt> array is the raw values that you&#8217;d expect to normally
find in the PHP <a class="reference external" href="http://php.net/manual/en/reserved.variables.server.php">$_SERVER</a> superglobal. For example, to set the <cite>Content-Type</cite>,
<cite>Referer</cite> and <cite>X-Requested-With&#8217; HTTP headers, you&#8217;d pass the following (mind
the `HTTP_</cite> prefix for non standard headers):</p>
<div class="last highlight-python"><pre>$client-&gt;request(
    'GET',
    '/demo/hello/Fabien',
    array(),
    array(),
    array(
        'CONTENT_TYPE'          =&gt; 'application/json',
        'HTTP_REFERER'          =&gt; '/foo/bar',
        'HTTP_X-Requested-With' =&gt; 'XMLHttpRequest',
    )
);</pre>
</div>
</div>
<div class="sidebar" id="index-3">
<p class="first sidebar-title">Useful Assertions</p>
<p>To get you started faster, here is a list of the most common and
useful test assertions:</p>
<div class="last highlight-python"><pre>// Assert that there is at least one h2 tag
// with the class "subtitle"
$this-&gt;assertGreaterThan(
    0,
    $crawler-&gt;filter('h2.subtitle')-&gt;count()
);

// Assert that there are exactly 4 h2 tags on the page
$this-&gt;assertCount(4, $crawler-&gt;filter('h2'));

// Assert that the "Content-Type" header is "application/json"
$this-&gt;assertTrue(
    $client-&gt;getResponse()-&gt;headers-&gt;contains(
        'Content-Type',
        'application/json'
    )
);

// Assert that the response content matches a regexp.
$this-&gt;assertRegExp('/foo/', $client-&gt;getResponse()-&gt;getContent());

// Assert that the response status code is 2xx
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isSuccessful());
// Assert that the response status code is 404
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isNotFound());
// Assert a specific 200 status code
$this-&gt;assertEquals(
    200,
    $client-&gt;getResponse()-&gt;getStatusCode()
);

// Assert that the response is a redirect to /demo/contact
$this-&gt;assertTrue(
    $client-&gt;getResponse()-&gt;isRedirect('/demo/contact')
);
// or simply check that the response is a redirect to any URL
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isRedirect());</pre>
</div>
</div>
</div>
</div>
<div class="section" id="working-with-the-test-client">
<span id="index-4"></span><h2>Working with the Test Client<a class="headerlink" href="#working-with-the-test-client" title="Permalink to this headline">¶</a></h2>
<p>The Test Client simulates an HTTP client like a browser and makes requests
into your Symfony2 application:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;request('GET', '/hello/Fabien');</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">request()</span></tt> method takes the HTTP method and a URL as arguments and
returns a <tt class="docutils literal"><span class="pre">Crawler</span></tt> instance.</p>
<p>Use the Crawler to find DOM elements in the Response. These elements can then
be used to click on links and submit forms:</p>
<div class="highlight-python"><pre>$link = $crawler-&gt;selectLink('Go elsewhere...')-&gt;link();
$crawler = $client-&gt;click($link);

$form = $crawler-&gt;selectButton('validate')-&gt;form();
$crawler = $client-&gt;submit($form, array('name' =&gt; 'Fabien'));</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">click()</span></tt> and <tt class="docutils literal"><span class="pre">submit()</span></tt> methods both return a <tt class="docutils literal"><span class="pre">Crawler</span></tt> object.
These methods are the best way to browse your application as it takes care
of a lot of things for you, like detecting the HTTP method from a form and
giving you a nice API for uploading files.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You will learn more about the <tt class="docutils literal"><span class="pre">Link</span></tt> and <tt class="docutils literal"><span class="pre">Form</span></tt> objects in the
<a class="reference internal" href="#book-testing-crawler"><em>Crawler</em></a> section below.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">request</span></tt> method can also be used to simulate form submissions directly
or perform more complex requests:</p>
<div class="highlight-python"><pre>// Directly submit a form (but using the Crawler is easier!)
$client-&gt;request('POST', '/submit', array('name' =&gt; 'Fabien'));

// Submit a raw JSON string in the request body
$client-&gt;request(
    'POST',
    '/submit',
    array(),
    array(),
    array('CONTENT_TYPE' =&gt; 'application/json'),
    '{"name":"Fabien"}'
);

// Form submission with a file upload
use Symfony\Component\HttpFoundation\File\UploadedFile;

$photo = new UploadedFile(
    '/path/to/photo.jpg',
    'photo.jpg',
    'image/jpeg',
    123
);
$client-&gt;request(
    'POST',
    '/submit',
    array('name' =&gt; 'Fabien'),
    array('photo' =&gt; $photo)
);

// Perform a DELETE requests, and pass HTTP headers
$client-&gt;request(
    'DELETE',
    '/post/12',
    array(),
    array(),
    array('PHP_AUTH_USER' =&gt; 'username', 'PHP_AUTH_PW' =&gt; 'pa$$word')
);</pre>
</div>
<p>Last but not least, you can force each request to be executed in its own PHP
process to avoid any side-effects when working with several clients in the same
script:</p>
<div class="highlight-python"><pre>$client-&gt;insulate();</pre>
</div>
<div class="section" id="browsing">
<h3>Browsing<a class="headerlink" href="#browsing" title="Permalink to this headline">¶</a></h3>
<p>The Client supports many operations that can be done in a real browser:</p>
<div class="highlight-python"><pre>$client-&gt;back();
$client-&gt;forward();
$client-&gt;reload();

// Clears all cookies and the history
$client-&gt;restart();</pre>
</div>
</div>
<div class="section" id="accessing-internal-objects">
<h3>Accessing Internal Objects<a class="headerlink" href="#accessing-internal-objects" title="Permalink to this headline">¶</a></h3>
<p class="versionadded">
<span class="versionmodified">New in version 2.3: </span>The <tt class="docutils literal"><span class="pre">getInternalRequest()</span></tt> and <tt class="docutils literal"><span class="pre">getInternalResponse()</span></tt> method were
added in Symfony 2.3.</p>
<p>If you use the client to test your application, you might want to access the
client&#8217;s internal objects:</p>
<div class="highlight-python"><pre>$history   = $client-&gt;getHistory();
$cookieJar = $client-&gt;getCookieJar();</pre>
</div>
<p>You can also get the objects related to the latest request:</p>
<div class="highlight-python"><pre>// the HttpKernel request instance
$request  = $client-&gt;getRequest();

// the BrowserKit request instance
$request  = $client-&gt;getInternalRequest();

// the HttpKernel response instance
$response = $client-&gt;getResponse();

// the BrowserKit response instance
$response = $client-&gt;getInternalResponse();

$crawler  = $client-&gt;getCrawler();</pre>
</div>
<p>If your requests are not insulated, you can also access the <tt class="docutils literal"><span class="pre">Container</span></tt> and
the <tt class="docutils literal"><span class="pre">Kernel</span></tt>:</p>
<div class="highlight-python"><pre>$container = $client-&gt;getContainer();
$kernel    = $client-&gt;getKernel();</pre>
</div>
</div>
<div class="section" id="accessing-the-container">
<h3>Accessing the Container<a class="headerlink" href="#accessing-the-container" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s highly recommended that a functional test only tests the Response. But
under certain very rare circumstances, you might want to access some internal
objects to write assertions. In such cases, you can access the dependency
injection container:</p>
<div class="highlight-python"><pre>$container = $client-&gt;getContainer();</pre>
</div>
<p>Be warned that this does not work if you insulate the client or if you use an
HTTP layer. For a list of services available in your application, use the
<tt class="docutils literal"><span class="pre">container:debug</span></tt> console task.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If the information you need to check is available from the profiler, use
it instead.</p>
</div>
</div>
<div class="section" id="accessing-the-profiler-data">
<h3>Accessing the Profiler Data<a class="headerlink" href="#accessing-the-profiler-data" title="Permalink to this headline">¶</a></h3>
<p>On each request, you can enable the Symfony profiler to collect data about the
internal handling of that request. For example, the profiler could be used to
verify that a given page executes less than a certain number of database
queries when loading.</p>
<p>To get the Profiler for the last request, do the following:</p>
<div class="highlight-python"><pre>// enable the profiler for the very next request
$client-&gt;enableProfiler();

$crawler = $client-&gt;request('GET', '/profiler');

// get the profile
$profile = $client-&gt;getProfile();</pre>
</div>
<p>For specific details on using the profiler inside a test, see the
<a class="reference internal" href="../cookbook/testing/profiling.html"><em>How to use the Profiler in a Functional Test</em></a> cookbook entry.</p>
</div>
<div class="section" id="redirecting">
<h3>Redirecting<a class="headerlink" href="#redirecting" title="Permalink to this headline">¶</a></h3>
<p>When a request returns a redirect response, the client does not follow
it automatically. You can examine the response and force a redirection
afterwards  with the <tt class="docutils literal"><span class="pre">followRedirect()</span></tt> method:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;followRedirect();</pre>
</div>
<p>If you want the client to automatically follow all redirects, you can
force him with the <tt class="docutils literal"><span class="pre">followRedirects()</span></tt> method:</p>
<div class="highlight-python"><pre>$client-&gt;followRedirects();</pre>
</div>
</div>
</div>
<div class="section" id="the-crawler">
<span id="book-testing-crawler"></span><span id="index-5"></span><h2>The Crawler<a class="headerlink" href="#the-crawler" title="Permalink to this headline">¶</a></h2>
<p>A Crawler instance is returned each time you make a request with the Client.
It allows you to traverse HTML documents, select nodes, find links and forms.</p>
<div class="section" id="traversing">
<h3>Traversing<a class="headerlink" href="#traversing" title="Permalink to this headline">¶</a></h3>
<p>Like jQuery, the Crawler has methods to traverse the DOM of an HTML/XML
document. For example, the following finds all <tt class="docutils literal"><span class="pre">input[type=submit]</span></tt> elements,
selects the last one on the page, and then selects its immediate parent element:</p>
<div class="highlight-python"><pre>$newCrawler = $crawler-&gt;filter('input[type=submit]')
    -&gt;last()
    -&gt;parents()
    -&gt;first()
;</pre>
</div>
<p>Many other methods are also available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">filter('h1.title')</span></tt></td>
<td>Nodes that match the CSS selector</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">filterXpath('h1')</span></tt></td>
<td>Nodes that match the XPath expression</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">eq(1)</span></tt></td>
<td>Node for the specified index</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">first()</span></tt></td>
<td>First node</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">last()</span></tt></td>
<td>Last node</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">siblings()</span></tt></td>
<td>Siblings</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">nextAll()</span></tt></td>
<td>All following siblings</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">previousAll()</span></tt></td>
<td>All preceding siblings</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">parents()</span></tt></td>
<td>Returns the parent nodes</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">children()</span></tt></td>
<td>Returns children nodes</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">reduce($lambda)</span></tt></td>
<td>Nodes for which the callable does not return false</td>
</tr>
</tbody>
</table>
<p>Since each of these methods returns a new <tt class="docutils literal"><span class="pre">Crawler</span></tt> instance, you can
narrow down your node selection by chaining the method calls:</p>
<div class="highlight-python"><pre>$crawler
    -&gt;filter('h1')
    -&gt;reduce(function ($node, $i)
    {
        if (!$node-&gt;getAttribute('class')) {
            return false;
        }
    })
    -&gt;first();</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Use the <tt class="docutils literal"><span class="pre">count()</span></tt> function to get the number of nodes stored in a Crawler:
<tt class="docutils literal"><span class="pre">count($crawler)</span></tt></p>
</div>
</div>
<div class="section" id="extracting-information">
<h3>Extracting Information<a class="headerlink" href="#extracting-information" title="Permalink to this headline">¶</a></h3>
<p>The Crawler can extract information from the nodes:</p>
<div class="highlight-python"><pre>// Returns the attribute value for the first node
$crawler-&gt;attr('class');

// Returns the node value for the first node
$crawler-&gt;text();

// Extracts an array of attributes for all nodes
// (_text returns the node value)
// returns an array for each element in crawler,
// each with the value and href
$info = $crawler-&gt;extract(array('_text', 'href'));

// Executes a lambda for each node and return an array of results
$data = $crawler-&gt;each(function ($node, $i)
{
    return $node-&gt;attr('href');
});</pre>
</div>
</div>
<div class="section" id="links">
<h3>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<p>To select links, you can use the traversing methods above or the convenient
<tt class="docutils literal"><span class="pre">selectLink()</span></tt> shortcut:</p>
<div class="highlight-python"><pre>$crawler-&gt;selectLink('Click here');</pre>
</div>
<p>This selects all links that contain the given text, or clickable images for
which the <tt class="docutils literal"><span class="pre">alt</span></tt> attribute contains the given text. Like the other filtering
methods, this returns another <tt class="docutils literal"><span class="pre">Crawler</span></tt> object.</p>
<p>Once you&#8217;ve selected a link, you have access to a special <tt class="docutils literal"><span class="pre">Link</span></tt> object,
which has helpful methods specific to links (such as <tt class="docutils literal"><span class="pre">getMethod()</span></tt> and
<tt class="docutils literal"><span class="pre">getUri()</span></tt>). To click on the link, use the Client&#8217;s <tt class="docutils literal"><span class="pre">click()</span></tt> method
and pass it a <tt class="docutils literal"><span class="pre">Link</span></tt> object:</p>
<div class="highlight-python"><pre>$link = $crawler-&gt;selectLink('Click here')-&gt;link();

$client-&gt;click($link);</pre>
</div>
</div>
<div class="section" id="forms">
<h3>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h3>
<p>Just like links, you select forms with the <tt class="docutils literal"><span class="pre">selectButton()</span></tt> method:</p>
<div class="highlight-python"><pre>$buttonCrawlerNode = $crawler-&gt;selectButton('submit');</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that you select form buttons and not forms as a form can have several
buttons; if you use the traversing API, keep in mind that you must look for a
button.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">selectButton()</span></tt> method can select <tt class="docutils literal"><span class="pre">button</span></tt> tags and submit <tt class="docutils literal"><span class="pre">input</span></tt>
tags. It uses several different parts of the buttons to find them:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">value</span></tt> attribute value;</li>
<li>The <tt class="docutils literal"><span class="pre">id</span></tt> or <tt class="docutils literal"><span class="pre">alt</span></tt> attribute value for images;</li>
<li>The <tt class="docutils literal"><span class="pre">id</span></tt> or <tt class="docutils literal"><span class="pre">name</span></tt> attribute value for <tt class="docutils literal"><span class="pre">button</span></tt> tags.</li>
</ul>
<p>Once you have a Crawler representing a button, call the <tt class="docutils literal"><span class="pre">form()</span></tt> method
to get a <tt class="docutils literal"><span class="pre">Form</span></tt> instance for the form wrapping the button node:</p>
<div class="highlight-python"><pre>$form = $buttonCrawlerNode-&gt;form();</pre>
</div>
<p>When calling the <tt class="docutils literal"><span class="pre">form()</span></tt> method, you can also pass an array of field values
that overrides the default ones:</p>
<div class="highlight-python"><pre>$form = $buttonCrawlerNode-&gt;form(array(
    'name'              =&gt; 'Fabien',
    'my_form[subject]'  =&gt; 'Symfony rocks!',
));</pre>
</div>
<p>And if you want to simulate a specific HTTP method for the form, pass it as a
second argument:</p>
<div class="highlight-python"><pre>$form = $buttonCrawlerNode-&gt;form(array(), 'DELETE');</pre>
</div>
<p>The Client can submit <tt class="docutils literal"><span class="pre">Form</span></tt> instances:</p>
<div class="highlight-python"><pre>$client-&gt;submit($form);</pre>
</div>
<p>The field values can also be passed as a second argument of the <tt class="docutils literal"><span class="pre">submit()</span></tt>
method:</p>
<div class="highlight-python"><pre>$client-&gt;submit($form, array(
    'name'              =&gt; 'Fabien',
    'my_form[subject]'  =&gt; 'Symfony rocks!',
));</pre>
</div>
<p>For more complex situations, use the <tt class="docutils literal"><span class="pre">Form</span></tt> instance as an array to set the
value of each field individually:</p>
<div class="highlight-python"><pre>// Change the value of a field
$form['name'] = 'Fabien';
$form['my_form[subject]'] = 'Symfony rocks!';</pre>
</div>
<p>There is also a nice API to manipulate the values of the fields according to
their type:</p>
<div class="highlight-python"><pre>// Select an option or a radio
$form['country']-&gt;select('France');

// Tick a checkbox
$form['like_symfony']-&gt;tick();

// Upload a file
$form['photo']-&gt;upload('/path/to/lucas.jpg');</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can get the values that will be submitted by calling the <tt class="docutils literal"><span class="pre">getValues()</span></tt>
method on the <tt class="docutils literal"><span class="pre">Form</span></tt> object. The uploaded files are available in a
separate array returned by <tt class="docutils literal"><span class="pre">getFiles()</span></tt>. The <tt class="docutils literal"><span class="pre">getPhpValues()</span></tt> and
<tt class="docutils literal"><span class="pre">getPhpFiles()</span></tt> methods also return the submitted values, but in the
PHP format (it converts the keys with square brackets notation - e.g.
<tt class="docutils literal"><span class="pre">my_form[subject]</span></tt> - to PHP arrays).</p>
</div>
</div>
</div>
<div class="section" id="testing-configuration">
<span id="index-6"></span><h2>Testing Configuration<a class="headerlink" href="#testing-configuration" title="Permalink to this headline">¶</a></h2>
<p>The Client used by functional tests creates a Kernel that runs in a special
<tt class="docutils literal"><span class="pre">test</span></tt> environment. Since Symfony loads the <tt class="docutils literal"><span class="pre">app/config/config_test.yml</span></tt>
in the <tt class="docutils literal"><span class="pre">test</span></tt> environment, you can tweak any of your application&#8217;s settings
specifically for testing.</p>
<p>For example, by default, the swiftmailer is configured to <em>not</em> actually
deliver emails in the <tt class="docutils literal"><span class="pre">test</span></tt> environment. You can see this under the <tt class="docutils literal"><span class="pre">swiftmailer</span></tt>
configuration option:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config_test.yml</span>

<span class="c1"># ...</span>
<span class="l-Scalar-Plain">swiftmailer</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">disable_delivery</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config_test.xml --&gt;</span>
<span class="nt">&lt;container&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;swiftmailer:config</span> <span class="na">disable-delivery=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config_test.php</span>

<span class="c1">// ...</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;swiftmailer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;disable_delivery&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>You can also use a different environment entirely, or override the default
debug mode (<tt class="docutils literal"><span class="pre">true</span></tt>) by passing each as options to the <tt class="docutils literal"><span class="pre">createClient()</span></tt>
method:</p>
<div class="highlight-python"><pre>$client = static::createClient(array(
    'environment' =&gt; 'my_test_env',
    'debug'       =&gt; false,
));</pre>
</div>
<p>If your application behaves according to some HTTP headers, pass them as the
second argument of <tt class="docutils literal"><span class="pre">createClient()</span></tt>:</p>
<div class="highlight-python"><pre>$client = static::createClient(array(), array(
    'HTTP_HOST'       =&gt; 'en.example.com',
    'HTTP_USER_AGENT' =&gt; 'MySuperBrowser/1.0',
));</pre>
</div>
<p>You can also override HTTP headers on a per request basis:</p>
<div class="highlight-python"><pre>$client-&gt;request('GET', '/', array(), array(), array(
    'HTTP_HOST'       =&gt; 'en.example.com',
    'HTTP_USER_AGENT' =&gt; 'MySuperBrowser/1.0',
));</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The test client is available as a service in the container in the <tt class="docutils literal"><span class="pre">test</span></tt>
environment (or wherever the <a class="reference internal" href="../reference/configuration/framework.html#reference-framework-test"><em>framework.test</em></a>
option is enabled). This means you can override the service entirely
if you need to.</p>
</div>
<div class="section" id="phpunit-configuration">
<span id="index-7"></span><h3>PHPUnit Configuration<a class="headerlink" href="#phpunit-configuration" title="Permalink to this headline">¶</a></h3>
<p>Each application has its own PHPUnit configuration, stored in the
<tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt> file. You can edit this file to change the defaults or
create a <tt class="docutils literal"><span class="pre">phpunit.xml</span></tt> file to tweak the configuration for your local machine.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Store the <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt> file in your code repository, and ignore the
<tt class="docutils literal"><span class="pre">phpunit.xml</span></tt> file.</p>
</div>
<p>By default, only the tests stored in &#8220;standard&#8221; bundles are run by the
<tt class="docutils literal"><span class="pre">phpunit</span></tt> command (standard being tests in the <tt class="docutils literal"><span class="pre">src/*/Bundle/Tests</span></tt> or
<tt class="docutils literal"><span class="pre">src/*/Bundle/*Bundle/Tests</span></tt> directories) But you can easily add more
directories. For instance, the following configuration adds the tests from
the installed third-party bundles:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- hello/phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;testsuites&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
<p>To include other directories in the code coverage, also edit the <tt class="docutils literal"><span class="pre">&lt;filter&gt;</span></tt>
section:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;whitelist&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;exclude&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/exclude&gt;</span>
    <span class="nt">&lt;/whitelist&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="learn-more">
<h2>Learn more<a class="headerlink" href="#learn-more" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../components/dom_crawler.html"><em>The DomCrawler Component</em></a></li>
<li><a class="reference internal" href="../components/css_selector.html"><em>The CssSelector Component</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/http_authentication.html"><em>How to simulate HTTP Authentication in a Functional Test</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/insulating_clients.html"><em>How to test the Interaction of several Clients</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/profiling.html"><em>How to use the Profiler in a Functional Test</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/bootstrap.html"><em>How to customize the Bootstrap Process before running Tests</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#the-phpunit-testing-framework">The PHPUnit Testing Framework</a></li>
<li><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li><a class="reference internal" href="#functional-tests">Functional Tests</a><ul>
<li><a class="reference internal" href="#your-first-functional-test">Your First Functional Test</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-the-test-client">Working with the Test Client</a><ul>
<li><a class="reference internal" href="#browsing">Browsing</a></li>
<li><a class="reference internal" href="#accessing-internal-objects">Accessing Internal Objects</a></li>
<li><a class="reference internal" href="#accessing-the-container">Accessing the Container</a></li>
<li><a class="reference internal" href="#accessing-the-profiler-data">Accessing the Profiler Data</a></li>
<li><a class="reference internal" href="#redirecting">Redirecting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-crawler">The Crawler</a><ul>
<li><a class="reference internal" href="#traversing">Traversing</a></li>
<li><a class="reference internal" href="#extracting-information">Extracting Information</a></li>
<li><a class="reference internal" href="#links">Links</a></li>
<li><a class="reference internal" href="#forms">Forms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-configuration">Testing Configuration</a><ul>
<li><a class="reference internal" href="#phpunit-configuration">PHPUnit Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#learn-more">Learn more</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="propel.html"
                        title="previous chapter">Databases and Propel</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="validation.html"
                        title="next chapter">Validation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/testing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="validation.html" title="Validation"
             >next</a> |</li>
        <li class="right" >
          <a href="propel.html" title="Databases and Propel"
             >previous</a> |</li>
        <li><a href="../index.html">Symfony Docs 2.3 documentation</a> &raquo;</li>
          <li><a href="index.html" >The Book</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Symfony Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>