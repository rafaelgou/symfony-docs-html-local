

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing &mdash; Symfony2Docs v0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Symfony2Docs v0 documentation" href="../index.html" />
    <link rel="up" title="Book" href="index.html" />
    <link rel="next" title="Validation" href="validation.html" />
    <link rel="prev" title="Databases and Doctrine (“The Model”)" href="doctrine.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="validation.html" title="Validation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="doctrine.html" title="Databases and Doctrine (“The Model”)"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs v0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Book</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="testing">
<span id="index-0"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Whenever you write a new line of code, you also potentially add new bugs.
Automated tests should have you covered and this tutorial shows you how to
write unit and functional tests for your Symfony2 application.</p>
<div class="section" id="testing-framework">
<h2>Testing Framework<a class="headerlink" href="#testing-framework" title="Permalink to this headline">¶</a></h2>
<p>Symfony2 tests rely heavily on PHPUnit, its best practices, and some
conventions. This part does not document PHPUnit itself, but if you don&#8217;t know
it yet, you can read its excellent <a class="reference external" href="http://www.phpunit.de/manual/3.5/en/">documentation</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Symfony2 works with PHPUnit 3.5.11 or later.</p>
</div>
<p>The default PHPUnit configuration looks for tests under the <tt class="docutils literal"><span class="pre">Tests/</span></tt>
sub-directory of your bundles:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/phpunit.xml.dist --&gt;</span>

<span class="nt">&lt;phpunit</span> <span class="na">bootstrap=</span><span class="s">&quot;../src/autoload.php&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testsuites&gt;</span>
        <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/testsuite&gt;</span>
    <span class="nt">&lt;/testsuites&gt;</span>

    ...
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</div>
<p>Running the test suite for a given application is straightforward:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># specify the configuration directory on the command line</span>
<span class="nv">$ </span>phpunit -c app/

<span class="c"># or run phpunit from within the application directory</span>
<span class="nv">$ </span><span class="nb">cd </span>app/
<span class="nv">$ </span>phpunit
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Code coverage can be generated with the <tt class="docutils literal"><span class="pre">--coverage-html</span></tt> option.</p>
</div>
</div>
<div class="section" id="unit-tests">
<span id="index-1"></span><h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>Writing Symfony2 unit tests is no different than writing standard PHPUnit unit
tests. By convention, it&#8217;s recommended to replicate the bundle directory
structure under its <tt class="docutils literal"><span class="pre">Tests/</span></tt> sub-directory. So, write tests for the
<tt class="docutils literal"><span class="pre">Acme\HelloBundle\Model\Article</span></tt> class in the
<tt class="docutils literal"><span class="pre">Acme/HelloBundle/Tests/Model/ArticleTest.php</span></tt> file.</p>
<p>In a unit test, autoloading is automatically enabled via the
<tt class="docutils literal"><span class="pre">src/autoload.php</span></tt> file (as configured by default in the <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt>
file).</p>
<p>Running tests for a given file or directory is also very easy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># run all tests for the Controller</span>
<span class="nv">$ </span>phpunit -c app src/Acme/HelloBundle/Tests/Controller/

<span class="c"># run all tests for the Model</span>
<span class="nv">$ </span>phpunit -c app src/Acme/HelloBundle/Tests/Model/

<span class="c"># run tests for the Article class</span>
<span class="nv">$ </span>phpunit -c app src/Acme/HelloBundle/Tests/Model/ArticleTest.php

<span class="c"># run all tests for the entire Bundle</span>
<span class="nv">$ </span>phpunit -c app src/Acme/HelloBundle/
</pre></div>
</div>
</div>
<div class="section" id="functional-tests">
<span id="index-2"></span><h2>Functional Tests<a class="headerlink" href="#functional-tests" title="Permalink to this headline">¶</a></h2>
<p>Functional tests check the integration of the different layers of an
application (from the routing to the views). They are no different from unit
tests as far as PHPUnit is concerned, but they have a very specific workflow:</p>
<ul class="simple">
<li>Make a request;</li>
<li>Test the response;</li>
<li>Click on a link or submit a form;</li>
<li>Test the response;</li>
<li>Rinse and repeat.</li>
</ul>
<p>Requests, clicks, and submissions are done by a client that knows how to talk
to the application. To access such a client, your tests need to extend the
Symfony2 <tt class="docutils literal"><span class="pre">WebTestCase</span></tt> class. The Symfony2 Standard Edition provides a
simple functional test for <tt class="docutils literal"><span class="pre">DemoController</span></tt> that reads as follows:</p>
<div class="highlight-python"><pre>// src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php
namespace Acme\DemoBundle\Tests\Controller;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class DemoControllerTest extends WebTestCase
{
    public function testIndex()
    {
        $client = static::createClient();

        $crawler = $client-&gt;request('GET', '/demo/hello/Fabien');

        $this-&gt;assertTrue($crawler-&gt;filter('html:contains("Hello Fabien")')-&gt;count() &gt; 0);
    }
}</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">createClient()</span></tt> method returns a client tied to the current application:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;request('GET', 'hello/Fabien');</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">request()</span></tt> method returns a <tt class="docutils literal"><span class="pre">Crawler</span></tt> object which can be used to
select elements in the Response, to click on links, and to submit forms.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The Crawler can only be used if the Response content is an XML or an HTML
document. For other content types, get the content of the Response with
<tt class="docutils literal"><span class="pre">$client-&gt;getResponse()-&gt;getContent()</span></tt>.</p>
<p class="last">You can set the content-type of the request to JSON by adding &#8216;HTTP_CONTENT_TYPE&#8217; =&gt; &#8216;application/json&#8217;.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The full signature of the <tt class="docutils literal"><span class="pre">request()</span></tt> method is:</p>
<div class="last highlight-python"><pre>request($method,
    $uri,
    array $parameters = array(),
    array $files = array(),
    array $server = array(),
    $content = null,
    $changeHistory = true
)</pre>
</div>
</div>
<p>Click on a link by first selecting it with the Crawler using either a XPath
expression or a CSS selector, then use the Client to click on it:</p>
<div class="highlight-python"><pre>$link = $crawler-&gt;filter('a:contains("Greet")')-&gt;eq(1)-&gt;link();

$crawler = $client-&gt;click($link);</pre>
</div>
<p>Submitting a form is very similar; select a form button, optionally override
some form values, and submit the corresponding form:</p>
<div class="highlight-python"><pre>$form = $crawler-&gt;selectButton('submit')-&gt;form();

// set some values
$form['name'] = 'Lucas';

// submit the form
$crawler = $client-&gt;submit($form);</pre>
</div>
<p>Each <tt class="docutils literal"><span class="pre">Form</span></tt> field has specialized methods depending on its type:</p>
<div class="highlight-python"><pre>// fill an input field
$form['name'] = 'Lucas';

// select an option or a radio
$form['country']-&gt;select('France');

// tick a checkbox
$form['like_symfony']-&gt;tick();

// upload a file
$form['photo']-&gt;upload('/path/to/lucas.jpg');</pre>
</div>
<p>Instead of changing one field at a time, you can also pass an array of values
to the <tt class="docutils literal"><span class="pre">submit()</span></tt> method:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;submit($form, array(
    'name'         =&gt; 'Lucas',
    'country'      =&gt; 'France',
    'like_symfony' =&gt; true,
    'photo'        =&gt; '/path/to/lucas.jpg',
));</pre>
</div>
<p>Now that you can easily navigate through an application, use assertions to test
that it actually does what you expect it to. Use the Crawler to make assertions
on the DOM:</p>
<div class="highlight-python"><pre>// Assert that the response matches a given CSS selector.
$this-&gt;assertTrue($crawler-&gt;filter('h1')-&gt;count() &gt; 0);</pre>
</div>
<p>Or, test against the Response content directly if you just want to assert that
the content contains some text, or if the Response is not an XML/HTML
document:</p>
<div class="highlight-python"><pre>$this-&gt;assertRegExp('/Hello Fabien/', $client-&gt;getResponse()-&gt;getContent());</pre>
</div>
<div class="section" id="useful-assertions">
<span id="index-3"></span><h3>Useful Assertions<a class="headerlink" href="#useful-assertions" title="Permalink to this headline">¶</a></h3>
<p>After some time, you will notice that you always write the same kind of
assertions. To get you started faster, here is a list of the most common and
useful assertions:</p>
<div class="highlight-python"><pre>// Assert that the response matches a given CSS selector.
$this-&gt;assertTrue($crawler-&gt;filter($selector)-&gt;count() &gt; 0);

// Assert that the response matches a given CSS selector n times.
$this-&gt;assertEquals($count, $crawler-&gt;filter($selector)-&gt;count());

// Assert the a response header has the given value.
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;headers-&gt;contains($key, $value));

// Assert that the response content matches a regexp.
$this-&gt;assertRegExp($regexp, $client-&gt;getResponse()-&gt;getContent());

// Assert the response status code.
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isSuccessful());
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isNotFound());
$this-&gt;assertEquals(200, $client-&gt;getResponse()-&gt;getStatusCode());

// Assert that the response status code is a redirect.
$this-&gt;assertTrue($client-&gt;getResponse()-&gt;isRedirect('google.com'));</pre>
</div>
</div>
</div>
<div class="section" id="the-test-client">
<span id="index-4"></span><h2>The Test Client<a class="headerlink" href="#the-test-client" title="Permalink to this headline">¶</a></h2>
<p>The test Client simulates an HTTP client like a browser.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The test Client is based on the <tt class="docutils literal"><span class="pre">BrowserKit</span></tt> and the <tt class="docutils literal"><span class="pre">Crawler</span></tt>
components.</p>
</div>
<div class="section" id="making-requests">
<h3>Making Requests<a class="headerlink" href="#making-requests" title="Permalink to this headline">¶</a></h3>
<p>The client knows how to make requests to a Symfony2 application:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;request('GET', '/hello/Fabien');</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">request()</span></tt> method takes the HTTP method and a URL as arguments and
returns a <tt class="docutils literal"><span class="pre">Crawler</span></tt> instance.</p>
<p>Use the Crawler to find DOM elements in the Response. These elements can then
be used to click on links and submit forms:</p>
<div class="highlight-python"><pre>$link = $crawler-&gt;selectLink('Go elsewhere...')-&gt;link();
$crawler = $client-&gt;click($link);

$form = $crawler-&gt;selectButton('validate')-&gt;form();
$crawler = $client-&gt;submit($form, array('name' =&gt; 'Fabien'));</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">click()</span></tt> and <tt class="docutils literal"><span class="pre">submit()</span></tt> methods both return a <tt class="docutils literal"><span class="pre">Crawler</span></tt> object.
These methods are the best way to browse an application as it hides a lot of
details. For instance, when you submit a form, it automatically detects the
HTTP method and the form URL, it gives you a nice API to upload files, and it
merges the submitted values with the form default ones, and more.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You will learn more about the <tt class="docutils literal"><span class="pre">Link</span></tt> and <tt class="docutils literal"><span class="pre">Form</span></tt> objects in the Crawler
section below.</p>
</div>
<p>But you can also simulate form submissions and complex requests with the
additional arguments of the <tt class="docutils literal"><span class="pre">request()</span></tt> method:</p>
<div class="highlight-python"><pre>// Form submission
$client-&gt;request('POST', '/submit', array('name' =&gt; 'Fabien'));

// Form submission with a file upload
$client-&gt;request('POST', '/submit', array('name' =&gt; 'Fabien'), array('photo' =&gt; '/path/to/photo'));

// Specify HTTP headers
$client-&gt;request('DELETE', '/post/12', array(), array(), array('PHP_AUTH_USER' =&gt; 'username', 'PHP_AUTH_PW' =&gt; 'pa$$word'));</pre>
</div>
<p>When a request returns a redirect response, the client automatically follows
it. This behavior can be changed with the <tt class="docutils literal"><span class="pre">followRedirects()</span></tt> method:</p>
<div class="highlight-python"><pre>$client-&gt;followRedirects(false);</pre>
</div>
<p>When the client does not follow redirects, you can force the redirection with
the <tt class="docutils literal"><span class="pre">followRedirect()</span></tt> method:</p>
<div class="highlight-python"><pre>$crawler = $client-&gt;followRedirect();</pre>
</div>
<p>Last but not least, you can force each request to be executed in its own PHP
process to avoid any side-effects when working with several clients in the same
script:</p>
<div class="highlight-python"><pre>$client-&gt;insulate();</pre>
</div>
</div>
<div class="section" id="browsing">
<h3>Browsing<a class="headerlink" href="#browsing" title="Permalink to this headline">¶</a></h3>
<p>The Client supports many operations that can be done in a real browser:</p>
<div class="highlight-python"><pre>$client-&gt;back();
$client-&gt;forward();
$client-&gt;reload();

// Clears all cookies and the history
$client-&gt;restart();</pre>
</div>
</div>
<div class="section" id="accessing-internal-objects">
<h3>Accessing Internal Objects<a class="headerlink" href="#accessing-internal-objects" title="Permalink to this headline">¶</a></h3>
<p>If you use the client to test your application, you might want to access the
client&#8217;s internal objects:</p>
<div class="highlight-python"><pre>$history   = $client-&gt;getHistory();
$cookieJar = $client-&gt;getCookieJar();</pre>
</div>
<p>You can also get the objects related to the latest request:</p>
<div class="highlight-python"><pre>$request  = $client-&gt;getRequest();
$response = $client-&gt;getResponse();
$crawler  = $client-&gt;getCrawler();</pre>
</div>
<p>If your requests are not insulated, you can also access the <tt class="docutils literal"><span class="pre">Container</span></tt> and
the <tt class="docutils literal"><span class="pre">Kernel</span></tt>:</p>
<div class="highlight-python"><pre>$container = $client-&gt;getContainer();
$kernel    = $client-&gt;getKernel();</pre>
</div>
</div>
<div class="section" id="accessing-the-container">
<h3>Accessing the Container<a class="headerlink" href="#accessing-the-container" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s highly recommended that a functional test only tests the Response. But
under certain very rare circumstances, you might want to access some internal
objects to write assertions. In such cases, you can access the dependency
injection container:</p>
<div class="highlight-python"><pre>$container = $client-&gt;getContainer();</pre>
</div>
<p>Be warned that this does not work if you insulate the client or if you use an
HTTP layer.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If the information you need to check are available from the profiler, use
them instead.</p>
</div>
</div>
<div class="section" id="accessing-the-profiler-data">
<h3>Accessing the Profiler Data<a class="headerlink" href="#accessing-the-profiler-data" title="Permalink to this headline">¶</a></h3>
<p>To assert data collected by the profiler, you can get the profile for the
current request like this:</p>
<div class="highlight-python"><pre>$profile = $client-&gt;getProfile();</pre>
</div>
</div>
<div class="section" id="redirecting">
<h3>Redirecting<a class="headerlink" href="#redirecting" title="Permalink to this headline">¶</a></h3>
<p>By default, the Client doesn&#8217;t follow HTTP redirects, so that you can get
and examine the Response before redirecting. Once you do want the client
to redirect, call the <tt class="docutils literal"><span class="pre">followRedirect()</span></tt> method:</p>
<div class="highlight-python"><pre>// do something that would cause a redirect to be issued (e.g. fill out a form)

// follow the redirect
$crawler = $client-&gt;followRedirect();</pre>
</div>
<p>If you want the Client to always automatically redirect, you can call the
<tt class="docutils literal"><span class="pre">followRedirects()</span></tt> method:</p>
<div class="highlight-python"><pre>$client-&gt;followRedirects();

$crawler = $client-&gt;request('GET', '/');

// all redirects are followed

// set Client back to manual redirection
$client-&gt;followRedirects(false);</pre>
</div>
</div>
</div>
<div class="section" id="the-crawler">
<span id="index-5"></span><h2>The Crawler<a class="headerlink" href="#the-crawler" title="Permalink to this headline">¶</a></h2>
<p>A Crawler instance is returned each time you make a request with the Client.
It allows you to traverse HTML documents, select nodes, find links and forms.</p>
<div class="section" id="creating-a-crawler-instance">
<h3>Creating a Crawler Instance<a class="headerlink" href="#creating-a-crawler-instance" title="Permalink to this headline">¶</a></h3>
<p>A Crawler instance is automatically created for you when you make a request
with a Client. But you can create your own easily:</p>
<div class="highlight-python"><pre>use Symfony\Component\DomCrawler\Crawler;

$crawler = new Crawler($html, $url);</pre>
</div>
<p>The constructor takes two arguments: the second one is the URL that is used to
generate absolute URLs for links and forms; the first one can be any of the
following:</p>
<ul class="simple">
<li>An HTML document;</li>
<li>An XML document;</li>
<li>A <tt class="docutils literal"><span class="pre">DOMDocument</span></tt> instance;</li>
<li>A <tt class="docutils literal"><span class="pre">DOMNodeList</span></tt> instance;</li>
<li>A <tt class="docutils literal"><span class="pre">DOMNode</span></tt> instance;</li>
<li>An array of the above elements.</li>
</ul>
<p>After creation, you can add more nodes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">addHTMLDocument()</span></tt></td>
<td>An HTML document</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">addXMLDocument()</span></tt></td>
<td>An XML document</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">addDOMDocument()</span></tt></td>
<td>A <tt class="docutils literal"><span class="pre">DOMDocument</span></tt> instance</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">addDOMNodeList()</span></tt></td>
<td>A <tt class="docutils literal"><span class="pre">DOMNodeList</span></tt> instance</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">addDOMNode()</span></tt></td>
<td>A <tt class="docutils literal"><span class="pre">DOMNode</span></tt> instance</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">addNodes()</span></tt></td>
<td>An array of the above elements</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">add()</span></tt></td>
<td>Accept any of the above elements</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="traversing">
<h3>Traversing<a class="headerlink" href="#traversing" title="Permalink to this headline">¶</a></h3>
<p>Like jQuery, the Crawler has methods to traverse the DOM of an HTML/XML
document:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">filter('h1')</span></tt></td>
<td>Nodes that match the CSS selector</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">filterXpath('h1')</span></tt></td>
<td>Nodes that match the XPath expression</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">eq(1)</span></tt></td>
<td>Node for the specified index</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">first()</span></tt></td>
<td>First node</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">last()</span></tt></td>
<td>Last node</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">siblings()</span></tt></td>
<td>Siblings</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">nextAll()</span></tt></td>
<td>All following siblings</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">previousAll()</span></tt></td>
<td>All preceding siblings</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">parents()</span></tt></td>
<td>Parent nodes</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">children()</span></tt></td>
<td>Children</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">reduce($lambda)</span></tt></td>
<td>Nodes for which the callable does not return false</td>
</tr>
</tbody>
</table>
<p>You can iteratively narrow your node selection by chaining method calls as
each method returns a new Crawler instance for the matching nodes:</p>
<div class="highlight-python"><pre>$crawler
    -&gt;filter('h1')
    -&gt;reduce(function ($node, $i)
    {
        if (!$node-&gt;getAttribute('class')) {
            return false;
        }
    })
    -&gt;first();</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Use the <tt class="docutils literal"><span class="pre">count()</span></tt> function to get the number of nodes stored in a Crawler:
<tt class="docutils literal"><span class="pre">count($crawler)</span></tt></p>
</div>
</div>
<div class="section" id="extracting-information">
<h3>Extracting Information<a class="headerlink" href="#extracting-information" title="Permalink to this headline">¶</a></h3>
<p>The Crawler can extract information from the nodes:</p>
<div class="highlight-python"><pre>// Returns the attribute value for the first node
$crawler-&gt;attr('class');

// Returns the node value for the first node
$crawler-&gt;text();

// Extracts an array of attributes for all nodes (_text returns the node value)
$crawler-&gt;extract(array('_text', 'href'));

// Executes a lambda for each node and return an array of results
$data = $crawler-&gt;each(function ($node, $i)
{
    return $node-&gt;getAttribute('href');
});</pre>
</div>
</div>
<div class="section" id="links">
<h3>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<p>You can select links with the traversing methods, but the <tt class="docutils literal"><span class="pre">selectLink()</span></tt>
shortcut is often more convenient:</p>
<div class="highlight-python"><pre>$crawler-&gt;selectLink('Click here');</pre>
</div>
<p>It selects links that contain the given text, or clickable images for which
the <tt class="docutils literal"><span class="pre">alt</span></tt> attribute contains the given text.</p>
<p>The Client <tt class="docutils literal"><span class="pre">click()</span></tt> method takes a <tt class="docutils literal"><span class="pre">Link</span></tt> instance as returned by the
<tt class="docutils literal"><span class="pre">link()</span></tt> method:</p>
<div class="highlight-python"><pre>$link = $crawler-&gt;link();

$client-&gt;click($link);</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <tt class="docutils literal"><span class="pre">links()</span></tt> method returns an array of <tt class="docutils literal"><span class="pre">Link</span></tt> objects for all nodes.</p>
</div>
</div>
<div class="section" id="forms">
<h3>Forms<a class="headerlink" href="#forms" title="Permalink to this headline">¶</a></h3>
<p>As for links, you select forms with the <tt class="docutils literal"><span class="pre">selectButton()</span></tt> method:</p>
<div class="highlight-python"><pre>$crawler-&gt;selectButton('submit');</pre>
</div>
<p>Notice that we select form buttons and not forms as a form can have several
buttons; if you use the traversing API, keep in mind that you must look for a
button.</p>
<p>The <tt class="docutils literal"><span class="pre">selectButton()</span></tt> method can select <tt class="docutils literal"><span class="pre">button</span></tt> tags and submit <tt class="docutils literal"><span class="pre">input</span></tt>
tags; it has several heuristics to find them:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">value</span></tt> attribute value;</li>
<li>The <tt class="docutils literal"><span class="pre">id</span></tt> or <tt class="docutils literal"><span class="pre">alt</span></tt> attribute value for images;</li>
<li>The <tt class="docutils literal"><span class="pre">id</span></tt> or <tt class="docutils literal"><span class="pre">name</span></tt> attribute value for <tt class="docutils literal"><span class="pre">button</span></tt> tags.</li>
</ul>
<p>When you have a node representing a button, call the <tt class="docutils literal"><span class="pre">form()</span></tt> method to get a
<tt class="docutils literal"><span class="pre">Form</span></tt> instance for the form wrapping the button node:</p>
<div class="highlight-python"><pre>$form = $crawler-&gt;form();</pre>
</div>
<p>When calling the <tt class="docutils literal"><span class="pre">form()</span></tt> method, you can also pass an array of field values
that overrides the default ones:</p>
<div class="highlight-python"><pre>$form = $crawler-&gt;form(array(
    'name'         =&gt; 'Fabien',
    'like_symfony' =&gt; true,
));</pre>
</div>
<p>And if you want to simulate a specific HTTP method for the form, pass it as a
second argument:</p>
<div class="highlight-python"><pre>$form = $crawler-&gt;form(array(), 'DELETE');</pre>
</div>
<p>The Client can submit <tt class="docutils literal"><span class="pre">Form</span></tt> instances:</p>
<div class="highlight-python"><pre>$client-&gt;submit($form);</pre>
</div>
<p>The field values can also be passed as a second argument of the <tt class="docutils literal"><span class="pre">submit()</span></tt>
method:</p>
<div class="highlight-python"><pre>$client-&gt;submit($form, array(
    'name'         =&gt; 'Fabien',
    'like_symfony' =&gt; true,
));</pre>
</div>
<p>For more complex situations, use the <tt class="docutils literal"><span class="pre">Form</span></tt> instance as an array to set the
value of each field individually:</p>
<div class="highlight-python"><pre>// Change the value of a field
$form['name'] = 'Fabien';</pre>
</div>
<p>There is also a nice API to manipulate the values of the fields according to
their type:</p>
<div class="highlight-python"><pre>// Select an option or a radio
$form['country']-&gt;select('France');

// Tick a checkbox
$form['like_symfony']-&gt;tick();

// Upload a file
$form['photo']-&gt;upload('/path/to/lucas.jpg');</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can get the values that will be submitted by calling the <tt class="docutils literal"><span class="pre">getValues()</span></tt>
method. The uploaded files are available in a separate array returned by
<tt class="docutils literal"><span class="pre">getFiles()</span></tt>. The <tt class="docutils literal"><span class="pre">getPhpValues()</span></tt> and <tt class="docutils literal"><span class="pre">getPhpFiles()</span></tt> also return
the submitted values, but in the PHP format (it converts the keys with
square brackets notation to PHP arrays).</p>
</div>
</div>
</div>
<div class="section" id="testing-configuration">
<span id="index-6"></span><h2>Testing Configuration<a class="headerlink" href="#testing-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="phpunit-configuration">
<span id="index-7"></span><h3>PHPUnit Configuration<a class="headerlink" href="#phpunit-configuration" title="Permalink to this headline">¶</a></h3>
<p>Each application has its own PHPUnit configuration, stored in the
<tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt> file. You can edit this file to change the defaults or
create a <tt class="docutils literal"><span class="pre">phpunit.xml</span></tt> file to tweak the configuration for your local machine.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Store the <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt> file in your code repository, and ignore the
<tt class="docutils literal"><span class="pre">phpunit.xml</span></tt> file.</p>
</div>
<p>By default, only the tests stored in &#8220;standard&#8221; bundles are run by the
<tt class="docutils literal"><span class="pre">phpunit</span></tt> command (standard being tests under Vendor\*Bundle\Tests
namespaces). But you can easily add more namespaces. For instance, the
following configuration adds the tests from the installed third-party bundles:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- hello/phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;testsuites&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
<p>To include other namespaces in the code coverage, also edit the <tt class="docutils literal"><span class="pre">&lt;filter&gt;</span></tt>
section:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;whitelist&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;exclude&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/exclude&gt;</span>
    <span class="nt">&lt;/whitelist&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="client-configuration">
<h3>Client Configuration<a class="headerlink" href="#client-configuration" title="Permalink to this headline">¶</a></h3>
<p>The Client used by functional tests creates a Kernel that runs in a special
<tt class="docutils literal"><span class="pre">test</span></tt> environment, so you can tweak it as much as you want:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><pre># app/config/config_test.yml
imports:
    - { resource: config_dev.yml }

framework:
    error_handler: false
    test: ~

web_profiler:
    toolbar: false
    intercept_redirects: false

monolog:
    handlers:
        main:
            type:  stream
            path:  %kernel.logs_dir%/%kernel.environment%.log
            level: debug</pre>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config_test.xml --&gt;</span>
<span class="nt">&lt;container&gt;</span>
    <span class="nt">&lt;imports&gt;</span>
        <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;config_dev.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/imports&gt;</span>

    <span class="nt">&lt;webprofiler:config</span>
        <span class="na">toolbar=</span><span class="s">&quot;false&quot;</span>
        <span class="na">intercept-redirects=</span><span class="s">&quot;false&quot;</span>
    <span class="nt">/&gt;</span>

    <span class="nt">&lt;framework:config</span> <span class="na">error_handler=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;framework:test</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/framework:config&gt;</span>

    <span class="nt">&lt;monolog:config&gt;</span>
        <span class="nt">&lt;monolog:main</span>
            <span class="na">type=</span><span class="s">&quot;stream&quot;</span>
            <span class="na">path=</span><span class="s">&quot;%kernel.logs_dir%/%kernel.environment%.log&quot;</span>
            <span class="na">level=</span><span class="s">&quot;debug&quot;</span>
         <span class="nt">/&gt;</span>
    <span class="nt">&lt;/monolog:config&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// app/config/config_test.php</span>
<span class="x">$loader-&gt;import(&#39;config_dev.php&#39;);</span>

<span class="x">$container-&gt;loadFromExtension(&#39;framework&#39;, array(</span>
<span class="x">    &#39;error_handler&#39; =&gt; false,</span>
<span class="x">    &#39;test&#39;          =&gt; true,</span>
<span class="x">));</span>

<span class="x">$container-&gt;loadFromExtension(&#39;web_profiler&#39;, array(</span>
<span class="x">    &#39;toolbar&#39; =&gt; false,</span>
<span class="x">    &#39;intercept-redirects&#39; =&gt; false,</span>
<span class="x">));</span>

<span class="x">$container-&gt;loadFromExtension(&#39;monolog&#39;, array(</span>
<span class="x">    &#39;handlers&#39; =&gt; array(</span>
<span class="x">        &#39;main&#39; =&gt; array(&#39;type&#39; =&gt; &#39;stream&#39;,</span>
<span class="x">                        &#39;path&#39; =&gt; &#39;%kernel.logs_dir%/%kernel.environment%.log&#39;</span>
<span class="x">                        &#39;level&#39; =&gt; &#39;debug&#39;)</span>

<span class="x">)));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>You can also change the default environment (<tt class="docutils literal"><span class="pre">test</span></tt>) and override the
default debug mode (<tt class="docutils literal"><span class="pre">true</span></tt>) by passing them as options to the
<tt class="docutils literal"><span class="pre">createClient()</span></tt> method:</p>
<div class="highlight-python"><pre>$client = static::createClient(array(
    'environment' =&gt; 'my_test_env',
    'debug'       =&gt; false,
));</pre>
</div>
<p>If your application behaves according to some HTTP headers, pass them as the
second argument of <tt class="docutils literal"><span class="pre">createClient()</span></tt>:</p>
<div class="highlight-python"><pre>$client = static::createClient(array(), array(
    'HTTP_HOST'       =&gt; 'en.example.com',
    'HTTP_USER_AGENT' =&gt; 'MySuperBrowser/1.0',
));</pre>
</div>
<p>You can also override HTTP headers on a per request basis:</p>
<div class="highlight-python"><pre>$client-&gt;request('GET', '/', array(), array(
    'HTTP_HOST'       =&gt; 'en.example.com',
    'HTTP_USER_AGENT' =&gt; 'MySuperBrowser/1.0',
));</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To provide your own Client, override the <tt class="docutils literal"><span class="pre">test.client.class</span></tt> parameter,
or define a <tt class="docutils literal"><span class="pre">test.client</span></tt> service.</p>
</div>
</div>
</div>
<div class="section" id="learn-more-from-the-cookbook">
<h2>Learn more from the Cookbook<a class="headerlink" href="#learn-more-from-the-cookbook" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/testing/http_authentication.html"><em>How to simulate HTTP Authentication in a Functional Test</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/insulating_clients.html"><em>How to test the Interaction of several Clients</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/profiling.html"><em>How to use the Profiler in a Functional Test</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#testing-framework">Testing Framework</a></li>
<li><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li><a class="reference internal" href="#functional-tests">Functional Tests</a><ul>
<li><a class="reference internal" href="#useful-assertions">Useful Assertions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-test-client">The Test Client</a><ul>
<li><a class="reference internal" href="#making-requests">Making Requests</a></li>
<li><a class="reference internal" href="#browsing">Browsing</a></li>
<li><a class="reference internal" href="#accessing-internal-objects">Accessing Internal Objects</a></li>
<li><a class="reference internal" href="#accessing-the-container">Accessing the Container</a></li>
<li><a class="reference internal" href="#accessing-the-profiler-data">Accessing the Profiler Data</a></li>
<li><a class="reference internal" href="#redirecting">Redirecting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-crawler">The Crawler</a><ul>
<li><a class="reference internal" href="#creating-a-crawler-instance">Creating a Crawler Instance</a></li>
<li><a class="reference internal" href="#traversing">Traversing</a></li>
<li><a class="reference internal" href="#extracting-information">Extracting Information</a></li>
<li><a class="reference internal" href="#links">Links</a></li>
<li><a class="reference internal" href="#forms">Forms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-configuration">Testing Configuration</a><ul>
<li><a class="reference internal" href="#phpunit-configuration">PHPUnit Configuration</a></li>
<li><a class="reference internal" href="#client-configuration">Client Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#learn-more-from-the-cookbook">Learn more from the Cookbook</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="doctrine.html"
                        title="previous chapter">Databases and Doctrine (&#8220;The Model&#8221;)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="validation.html"
                        title="next chapter">Validation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/testing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="validation.html" title="Validation"
             >next</a> |</li>
        <li class="right" >
          <a href="doctrine.html" title="Databases and Doctrine (“The Model”)"
             >previous</a> |</li>
        <li><a href="../index.html">Symfony2Docs v0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Book</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Rafael Goulart.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>